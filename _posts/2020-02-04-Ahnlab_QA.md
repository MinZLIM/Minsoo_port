---
layout: post
title:  "TrusGuard QA Engineering"
date:   2020-02-04 10:00:40
blurb: ""
og_image: /assets/img/work/utm.png
---

<br />

Ahnlab 의 Network QA 팀에서 TrusGuard 와 TMS 의 QA 를 진행.
<br />
TrusGuard 는 어플라이언스 UTM 제품으로 주요 Firewall , Content Filter , VPN , etc 다양한 기능을 제공한다. 
<br />
TMS 는 Ahnlab 의 어플라이언스 제품군의 통합 관리를 위한 제품으로 정책 및 로그 관리를 수행한다. 

<br />


#### Table of Contents
1. [개요](#개요)
2. [Object](#object)
    * [Object info](#object-info)
    * [Object 수행업무](#object-수행업무)
    * [Object 검증 성과](#object-검증-성과) 
3. [Policy](#policy)
    * [Linux Net Filter Framework](#linux-net-filter-framework)
    * [Protocol Anomaly](#protocol-anomaly)
4. [Content Filter](#content-filter)
    * [Proxy 기능에 대한 이해](#proxy-기능에-대한-이해)
    * [L7 프로토콜에 대한 지식 및 환경](#l7-프로토콜에-대한-지식-및-환경)
5. [System](#system)
    * [인프라 유지보수](#인프라-유지보수)
    * [인증 프로토콜에 대한 이해 및 운용](#인증-프로토콜에-대한-이해-및-운용)

#### 개요
Ahnlab 의 TrusGuard 장비는 UTM 어플라이언스로써 QA 를 진행하기 위해 크게 다음 하기의 Skill Set 을 요구 한다. 
 - Network Engineering
 - Server Engineering
 - Linux Script
<br />

본 장에서는 담당 기능에 대한 간략한 설명과 진행 업무,검증을 통한 성과를 서술한다. 

##### TrusGuard 담당 검증 기능
 - Object
 - Policy
 - Content Filter
 - System
 
<br />

---

#### Object

##### Object info
Object(객체)기능은 TrusGuard 의 정책에 적용하기 위한 객체들을 설정하기 위한 기능으로 주요 다음의 객체들을 지원한다. 
 - IPv4/6 주소 : IP주소를 설정하는 것으로 CIDR , 범위 , class 단위로 객체를 생성하며 그룹화하여 관리가 가능하다. 
 - Service : 프로토콜 기반 객체이며 4 가지 프로토콜(TCP,UDP,ICMP,IP)을 기반으로 포트 번호를 Custom 하여 사용할 수 있다. 기본적으로 주용 프로토콜들을 포함하여 약 100 개의 기본 서비스 객체를 제공한다.
 - 일정 / QoS : 정책이 동작할 일정 , QoS 등을 설정한다. 
 - FQDN : DNS 주소는 동적 변환 주소로 DNS 정보와 IP 를 hash table 로 매핑하여 linux netfilter 에 참조 정보로 매칭 시킨다.  
 - 사용자 인증 객체 : 사용자 주소 , DIP(Device info Profile) , 인증서버 등 ZTNA(Zero Trust Network Access) 를 위한 기본기능으로 Ahnlab 에서 제공하는 EPP , EMS 제품을 연동하며, 이외 LDAP,msssql 과 같은 프로토콜을 통해 추가 인증을 수행하는데 사용되는 객체이다.

##### Object 수행 업무
###### Skill Keyword : Server Engineering
서비스 객체에 대한 실제 트래픽 매칭을 확인하기 위한 서버 구성 <br />
 Detail info : https://minzlim.github.io/Minsoo_port/2020/02/02/Maintain_Server

##### Object 검증 성과
 - 이슈 51건 (Bug : 42, improvement : 9)
 - 주요 이슈
netfilter 매칭 실패 : 디바이스 제어 방화벽 정책에 연동되지 않음.
최대 값 테스트  : 객체 최대 추가된 상태에서 일정 객체 csv export 수행 시 read from server failed 발생

---

#### Policy
보안 장비로써 근간이 되는 기능으로 다음과 같은 보안 정책들을 지원한다. 
 - IPv4/6 기본 정책 : 5 tuple 을 기반으로 한 방화벽 정책
 - 사용자 인증 정책 : 내부 Client 의 인가여부를 확인 하여 트래픽을 제어한다. 
 - NAT : DNAT,SNAT , PBNAT 등 IP주소 변환 기술을 통하여 통신 환경을 구성하기 위해 사용된다.
 - 접근제어 : Black List, White List , 프로토콜 이상 등 방화벽 정책 이전 트래픽을 검사하여 허용/차단 여부를 결정한다. 
 - 지역기반 차단 : IP 주소 정보를 기반으로 하여 각 국가 코드를 보여주며 , 정책을 설정한다.

##### Linux Net Filter Framework
TG 는 리눅스 커널 기반 보안 장비로 기본적으로 NetFilter framework 포맷을 따라 패킷을 처리한다.
<img src="{{ "/assets/img/content/Netfilter%20Framework.png" | absolute_url }}" alt="bay" class="post-pic"/>
다음과 같이 FQDN 및 User Auth 와 같은 특정 기능은 해당 객체의 Hash Table 을 통해서 관리한다.
 


##### Protocol Anomaly
다음과 같은 4 가지 프로토콜의 헤더 정보를 확인하여 이상 프로토콜에 대한 탐지 및 차단 정책을 수행한다. 
 - IPv4/IPv6
   > IP 스푸핑 / Land Attack / ETC
 - UDP
   > 헤더 정보 불일치 
 - TCP
   > 비정상 플래그 , 헤더 정보 불일치 
 - ICMP
   > Ping of Death 

---


#### Content Filter
Content Filter 기능은 Proxy 및 Non Proxy 환경에서 L7 프로토콜의 header 및 Body 정보를 기반으로 분석하여 악성 코드 및 행위를 탐지하기 위한 기능으로 다음 기능을 테스트 하기위해서는 하기와 같은 지식 및 환경을 요구 한다. 
 - Proxy 기능에 대한 이해
 - L7 프로토콜에 대한 지식 및 환경

<br />

TrusGuadr 에서는 Content Filter을 통해 다음의 기능들을 제공한다. 
 - 안티 바이러스 : TrusGuard 에 V3 의 탐지 엔진(TS)을 이용하여 악성코드를 탐지/차단 한다. 
 - 안티 스팸 : Cyren 사의 탐지 엔진을 활용하여 rdp,메일폭탄등 STMP/POP3 기반의 프로토콜을 탐지/차단한다. 
 - 웹 필터 : http/https 기반에서 request 및 response 의 data 를 기반으로 url , 카테고리 , pics , 등의 기능으로 웹 접근을 탐지/차단한다. 
 - 유해사이트 / C&C 차단 : ahnlab 의 AIDC 에서 IP 및 URL 정보에 대한 DB를 기준으로 탐지/차단한다.   

<br />

##### Proxy 기능에 대한 이해
Proxy 란 Netowrk 환경에서 접속하려는 Client 와 Server 사이에 세션을 별도로 생성하여 Client 및 Server 에 대한 정보를 보호 , Load Balancing 등의 기능을 한다.
<br />
 여기에 그림 넣자
<br />
Trusguard 에서는 사용방법에 따라 크게 3 가지 Proxy 기능을 제공한다.
 - Forward Proxy  
 - Reverse Proxy  
 - Transparent Proxy

<br />

##### L7 프로토콜에 대한 지식 및 환경
TrusGuard 에서는 프록시 기능을 지원하는 프로토콜로 하기의 프로토콜들을 지원하며 Content Filter 기능 테스트를 위해서는 다양한 환경이 필요하여 하기와 같은 조건들의 테스트 서버를 구축 및 운영하며 관리하고 있다.
 - HTTP/HTTPS
 - SMTP/SMTPS
 - DNS
 - POP3/POP3S
 - FTP/FTPS

<br />

[Maintain Test Server info](https://minzlim.github.io/Minsoo_port/2020/02/02/Maintain_Server)

<br />

---


#### System 
어플라이언스 제품으로 써 사용자 편의를 위하여 다음과 같은 기능들을 제공하고 있다. 
System 기능을 검증하기 위해서는 다음과 같은 지식 및 환경을 필요로 한다. 
 - 인프라 유지보수
 - 인증 프로토콜에 대한 이해 및 운용

TrusGuard 의 System 메뉴에서는 주로 하기의 기능을 확인 할 수 있다. 
 - 시스템 정보 Custom
 - User control
 - 백업/복원
 - Alert 조건

##### 인프라 유지보수
TrusGuard 는 기본적으로 UTM 시스템이기 때문에 24 시간 운영이 가능하여야 하며 트래픽 처리 및 이벤트 발생에 대한 로그를 지속적 및 안전하게 기록하여야 한다.
로그를 저장하는 방법은 Local 시스템 저장 , 원격 저장 방법이 있다.
TrusGuard 는 운영되는 인프라의 요건에 맞게 시간/용량 조건으로 log 를 백업 할 수 있으며 이를 위한 FTP 서버를 운영하며 유지보수를 수행하고 있다. 
 

##### 인증 프로토콜에 대한 이해 및 운용
TrusGuard 에서는 외부 인증서버를 통한 관리자 계정 로그인 기능을 지원하고 있으며 이를 테스트 하기 위한 인증 서버를 운영 및 구축할 수 있어야 한다. 
 - LDAP
 - tacas+
 - OTP
 - RADIUS

